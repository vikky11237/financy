<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Background Elements -->
    <div class="background">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <!-- Main Container -->
    <div class="dashboard-wrapper">
        <header class="dashboard-header">
            <h1>Hello <span id="username">User</span></h1>
            <button class="btn-ghost" onclick="logout()">Logout</button>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('overview')">Overview</button>
            <button class="tab-btn" onclick="openTab('loan-analysis')">Loan Portfolio</button>
            <button class="tab-btn" onclick="openTab('incomes')">Add Income</button>
            <button class="tab-btn" onclick="openTab('expenses')">Add Expenses</button>
            <button class="tab-btn" onclick="openTab('loans')">Add Loan</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">

            <!-- Overview Tab -->
            <div id="overview" class="tab-pane active">
                <div class="section-header">
                    <h2>Financial Overview</h2>
                    <button class="btn-ghost small" onclick="toggleBudgetModal()">Set Budget</button>
                </div>

                <!-- Budget Cards -->
                <div class="cards-container budget-cards">
                    <div class="card budget-card">
                        <h3>Monthly Income</h3>
                        <p id="b-income">₹0</p>
                    </div>
                    <div class="card budget-card">
                        <h3>Budget Limit</h3>
                        <p id="b-limit">₹0</p>
                    </div>
                    <div class="card budget-card">
                        <h3>Total Expenses</h3>
                        <p id="total-expenses">₹0</p>
                    </div>
                    <div class="card budget-card highlight">
                        <h3>Spendable (Income - EMI - Spent)</h3>
                        <p id="b-spendable">₹0</p>
                    </div>
                </div>

                <!-- Recent Expenses Summary -->
                <h3>Recent Expenses</h3>
                <div id="overview-expenses-list" class="expense-list" style="max-height: 300px; overflow-y: auto;">
                    <!-- JS will populate top 5 expenses here -->
                </div>
            </div>

            <!-- Loan Analysis Tab -->
            <div id="loan-analysis" class="tab-pane">
                <div class="section-header">
                    <h2>Loan Portfolio</h2>
                    <div class="sort-controls">
                        <label for="loan-sort">Sort by:</label>
                        <select id="loan-sort" onchange="fetchLoanPortfolio()">
                            <option value="default">Default</option>
                            <option value="tenure-asc">Tenure (Low to High)</option>
                            <option value="tenure-desc">Tenure (High to Low)</option>
                            <option value="amount-desc">Principal (High to Low)</option>
                            <option value="amount-asc">Principal (Low to High)</option>
                        </select>
                    </div>
                </div>

                <!-- Loan Stats -->
                <div class="cards-container">
                    <div class="card">
                        <h3>Active Loans</h3>
                        <p id="active-loans-count">0</p>
                    </div>
                    <div class="card">
                        <h3>Total Monthly EMI</h3>
                        <p id="total-emi">₹0</p>
                    </div>
                    <div class="card">
                        <h3>Total Debt Remaining</h3>
                        <p id="total-debt">₹0</p>
                    </div>
                </div>

                <h3>Your Loans</h3>
                <div id="loan-list" class="loan-list">
                    <!-- JS will populate detailed loan cards here -->
                </div>
            </div>



            <!-- Add Income Tab -->
            <div id="incomes" class="tab-pane">
                <h2>Add New Income</h2>
                <form id="incomeForm">
                    <div class="input-group">
                        <i class="fas fa-rupee-sign"></i>
                        <input type="number" id="income-amount" placeholder="Amount (INR)" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-briefcase"></i>
                        <input type="text" id="income-source" placeholder="Source (e.g., Salary, Freelance)" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-edit"></i>
                        <input type="text" id="income-desc" placeholder="Description" />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="date" id="income-date" required />
                    </div>
                    <button type="submit" class="btn-primary" id="income-submit-btn">Add Income</button>
                    <button type="button" class="btn-ghost" id="income-cancel-btn" style="display: none;"
                        onclick="cancelEdit('income')">Cancel</button>
                </form>

                <div class="list-section">
                    <h3>Recent Incomes</h3>
                    <div id="income-list" class="expense-list">
                        <!-- Incomes will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Add Expenses Tab -->
            <div id="expenses" class="tab-pane">
                <div class="section-header">
                    <h2>Track New Expense</h2>
                    <button class="btn-ghost small" onclick="document.getElementById('expense-csv').click()"
                        title="CSV Format: Amount,Category,Description,Date (YYYY-MM-DD)">
                        <i class="fas fa-file-upload"></i> Import CSV
                    </button>
                    <input type="file" id="expense-csv" accept=".csv" style="display: none;"
                        onchange="handleExpenseCSV(this)">
                </div>
                <form id="expenseForm">
                    <div class="input-group">
                        <i class="fas fa-rupee-sign"></i>
                        <input type="number" id="expense-amount" placeholder="Amount (INR)" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-tag"></i>
                        <select id="expense-category" required>
                            <option value="" disabled selected>Select Category</option>
                            <option value="Food">Food & Dining</option>
                            <option value="Groceries">Groceries</option>
                            <option value="Transport">Transport (Fuel/Commute)</option>
                            <option value="Bills">Bills & Utilities</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Habits">Habits (Smoking, etc.)</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Health">Healthcare</option>
                            <option value="Education">Education</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-edit"></i>
                        <input type="text" id="expense-desc" placeholder="Description" />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="date" id="expense-date" required />
                    </div>
                    <button type="submit" class="btn-primary" id="expense-submit-btn">Add Expense</button>
                    <button type="button" class="btn-ghost" id="expense-cancel-btn" style="display: none;"
                        onclick="cancelEdit('expense')">Cancel</button>
                </form>

                <div class="list-section">
                    <h3>Recent Expenses</h3>
                    <div id="expense-list" class="expense-list">
                        <!-- Expenses will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Add Loan Tab -->
            <div id="loans" class="tab-pane">
                <h2>Add Loan Details</h2>
                <form id="loanForm">
                    <div class="input-group">
                        <i class="fas fa-file-signature"></i>
                        <input type="text" id="loan-name" placeholder="Loan Name (e.g., Car Loan)" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-rupee-sign"></i>
                        <input type="number" id="loan-amount" placeholder="Total Loan Amount" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-percent"></i>
                        <input type="number" id="loan-interest" placeholder="Interest Rate (%)" step="0.1" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-calendar-check"></i>
                        <input type="number" id="loan-tenure" placeholder="Tenure (Months)" required />
                    </div>
                    <div class="input-group">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="date" id="loan-date" required />
                    </div>
                    <button type="submit" class="btn-primary" id="loan-submit-btn">Calculate & Add Loan</button>
                    <button type="button" class="btn-ghost" id="loan-cancel-btn" style="display: none;"
                        onclick="cancelEdit('loan')">Cancel</button>
                </form>
                <div id="loan-result" class="result-box hidden">
                    <p>Estimated EMI: <span id="display-emi">₹0</span></p>
                    <p>Total Payable: <span id="display-payable">₹0</span></p>
                </div>
            </div>

        </div>
    </div>

    <!-- Budget Modal (Moved outside for fixed positioning) -->
    <div id="budget-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="toggleBudgetModal()">&times;</span>
            <h2>Set Budget Limit</h2>
            <p style="font-size: 0.9em; color: #ccc; margin-bottom: 15px;">Note: Monthly Income is now calculated
                automatically from your added incomes.</p>
            <div class="input-group">
                <i class="fas fa-piggy-bank"></i>
                <input type="number" id="set-limit" placeholder="Budget Limit (Expenses)" />
            </div>
            <button class="btn-primary" onclick="saveBudget()">Save</button>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <script src="dashboard.js"></script>
</body>

</html>